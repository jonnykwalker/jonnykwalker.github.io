<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c5{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#000000;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:20pt;font-family:"Arial";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c8{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c9{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c3{color:#00ff00}.c7{margin-left:36pt}.c4{color:#ff0000}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c9 doc-content"><p class="c6"><span class="c5">Deprovision User Accounts </span></p><p class="c2"><span class="c0"></span></p><p class="c7 c8"><span class="c3">#Purpose: Fully deprovision users being offboarded and add notes to telephone tab in AD</span></p><p class="c2"><span class="c0"></span></p><p class="c1"><span class="c0">$csvPath = &quot;C:\Users\Public\Documents\Terminations.csv&quot; </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span>$targetOU = &quot;OU=</span><span class="c4">&lt;obfuscated&gt;</span><span>,OU=</span><span class="c4">&lt;obfuscated&gt;</span><span>,DC=</span><span class="c4">&lt;obfuscated&gt;</span><span>,DC=</span><span class="c4">&lt;obfuscated&gt;</span><span>,DC=</span><span class="c4">&lt;obfuscated&gt;</span><span class="c0">&quot; </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">$users = Import-Csv -Path $csvPath </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">foreach ($userRecord in $users) { </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user = $userRecord.Username </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newNote = $userRecord.NewNote </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disable-ADAccount -Identity $user </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$groups = Get-ADPrincipalGroupMembership -Identity $user </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($group in $groups) { </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remove-ADGroupMember -Identity $group -Members $user -Confirm:$false </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$currentNotes = (Get-ADUser $user -Properties info).info </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$updatedNotes = &quot;$currentNotes`r`n$newNote&quot; </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set-ADUser $user -Replace @{info = $updatedNotes} </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1 c7"><span class="c0">Move-ADObject -Identity (Get-ADUser $user).DistinguishedName -TargetPath $targetOU </span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Output &quot;Deprovision process completed for $user&quot; </span></p><p class="c1"><span class="c0">} </span></p><p class="c2"><span class="c0"></span></p></body></html>